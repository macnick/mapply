(()=>{"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=i(t);if(e){var a=i(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return r(this,n)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?a(e):n}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function c(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var d=function(){function t(e,n,o,r){s(this,t),l(this,"id",Date.now().toString().slice(-9)),this.date=r,this.coords=e,this.distance=n,this.duration=o}return c(t,[{key:"_setDescription",value:function(){this.description="".concat(this.type[0].toUpperCase()).concat(this.type.slice(1)," on ").concat(["January","February","March","April","May","June","July","August","September","October","November","December"][this.date.getMonth()]," ").concat(this.date.getDate())}}]),t}(),p=function(t){e(r,t);var n=o(r);function r(t,e,o,i,u){var c;return s(this,r),l(a(c=n.call(this,t,e,o,i)),"type","running"),c.cadence=u,c.calcPace(),c._setDescription(),c}return c(r,[{key:"calcPace",value:function(){return this.pace=this.duration/this.distance,this}}]),r}(d),h=function(t){e(r,t);var n=o(r);function r(t,e,o,i,u){var c;return s(this,r),l(a(c=n.call(this,t,e,o,i)),"type","cycling"),c.elevGain=u,c.calcSpeed(),c._setDescription(),c}return c(r,[{key:"calcSpeed",value:function(){this.speed=this.distance/this.duration*60}}]),r}(d);function f(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,m(t,e,"set"),n),n}function _(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,m(t,e,"get"))}function m(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var k=document.querySelector(".form"),g=document.querySelector(".workouts"),w=document.querySelector(".form__input--type"),b=document.querySelector(".form__input--distance"),S=document.querySelector(".form__input--duration"),W=document.querySelector(".form__input--cadence"),O=document.querySelector(".form__input--elevation"),P=new WeakMap,M=new WeakMap,E=new WeakMap,T=new WeakMap;new(function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),P.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:void 0}),E.set(this,{writable:!0,value:[]}),T.set(this,{writable:!0,value:{streets:"m",hybrid:"s,h",sat:"s",terrain:"p"}}),y(this,"streets",this._changeLayer("streets")),y(this,"hybrid",this._changeLayer("hybrid")),y(this,"satellite",this._changeLayer("sat")),y(this,"terrain",this._changeLayer("terrain")),y(this,"basemaps",{Streets:this.streets,Satellite:this.satellite,Hybrid:this.hybrid,Terrain:this.terrain}),this._getPosition(),k.addEventListener("submit",(function(t){return e._newWorkout(t)})),w.addEventListener("change",this._toggleElevation),g.addEventListener("click",(function(t){return e._handleClick(t)}))}var e,n;return e=t,(n=[{key:"_changeLayer",value:function(t){return L.tileLayer("http://{s}.google.com/vt/lyrs=".concat(_(this,T)[t],"&x={x}&y={y}&z={z}"),{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]})}},{key:"_handleClick",value:function(t){if(this._moveToMarker(t),t.target.className.includes("trash")){var e=t.target.closest(".workout").dataset.id;this._deleteWorkout(e)}}},{key:"_deleteWorkout",value:function(t){for(var e=0;e<_(this,E).length;e++)_(this,E)[e].id==t&&(this._deleteMarker(_(this,E)[e]),_(this,E).splice(e,1));this._storeWorkouts(),document.getElementById(t).remove()}},{key:"_getPosition",value:function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(this._loadMap.bind(this),(function(){return console.log("there was an error getting your position ")}))}},{key:"_loadMap",value:function(t){var e=this,n=t.coords,o=n.latitude,r=n.longitude;v(this,P,L.map("map",{layers:[this.streets,this.hybrid]}).setView([o,r],14)),L.tileLayer("http://{s}.google.com/vt/lyrs=".concat(_(this,T).streets,"&x={x}&y={y}&z={z}"),{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}).addTo(_(this,P)),L.control.layers(this.basemaps,null).addTo(_(this,P)),L.marker([o,r]).addTo(_(this,P)).bindPopup("You are here!").openPopup(),this._loadWorkouts(),_(this,P).on("click",(function(t){return e._showForm(t)}))}},{key:"_showForm",value:function(t){k.classList.remove("hidden"),b.focus(),v(this,M,t.latlng)}},{key:"_toggleElevation",value:function(){W.closest(".form__row").classList.toggle("form__row--hidden"),O.closest(".form__row").classList.toggle("form__row--hidden")}},{key:"_clearForm",value:function(){b.value="",S.value="",W.value="",O.value="",k.classList.add("hidden")}},{key:"_notValid",value:function(t){return isNaN(t)||t<=0}},{key:"_newWorkout",value:function(t){t.preventDefault(),this._changeLayer("terain");var e=w.value,n=+b.value,o=+S.value;if(this._notValid(o)||this._notValid(n))return alert("Inputs have to be positive numbers!");if("running"===e){var r=+W.value;if(this._notValid(r))return alert("Cadence must be a positive number!");var a=new p(_(this,M),n,o,new Date,r,e);_(this,E).push(a),console.log(_(this,E)),this._renderWorkoutMarker(a)}if("cycling"===e){var i=+O.value;if(isNaN(i))return alert("Elevation must be a number!");var s=new h(_(this,M),n,o,new Date,i,e);_(this,E).push(s),this._renderWorkoutMarker(s)}}},{key:"_deleteMarker",value:function(t){console.log("trying to delete the marker now");var e=t.coords,n=[e.lat,e.lng];_(this,P).removeLayer(n)}},{key:"_renderWorkoutMarker",value:function(t){var e=t.coords,n=e.lat,o=e.lng;L.marker([n,o]).addTo(_(this,P)).bindPopup(L.popup({maxWidth:250,minWidth:120,riseOnHover:!0,autoClose:!1,closeOnClick:!1,className:"".concat(t.type,"-popup")})).setPopupContent("".concat("running"===t.type?"üèÉ‚Äç‚ôÇÔ∏è":"üö¥‚Äç‚ôÄÔ∏è"," ").concat(t.description)).openPopup(),this._clearForm(),this._renderWorkout(t),this._storeWorkouts()}},{key:"_renderWorkout",value:function(t){var e=t.type,n='\n    <li class="workout workout--'.concat(e,'" data-id="').concat(t.id,'" id="').concat(t.id,'">\n    <h2 class="workout__title">').concat(t.description,'</h2>\n    <div class="workout__details">\n      <span class="workout__icon">').concat("running"===e?"üèÉ‚Äç‚ôÇ":"üö¥‚Äç‚ôÄÔ∏è",'</span>\n      <span class="workout__value">').concat(t.distance,'</span>\n      <span class="workout__unit">km</span>\n    </div>\n    <div class="workout__details">\n      <span class="workout__icon">‚è±</span>\n      <span class="workout__value">').concat(t.duration,'</span>\n      <span class="workout__unit">min</span>\n    </div>\n    <div class="workout__details">\n            <span class="workout__icon">‚ö°Ô∏è</span>\n            <span class="workout__value">').concat("running"===e?t.pace.toFixed(1):t.speed.toFixed(1),'</span>\n            <span class="workout__unit">').concat("running"===e?"min/km":"km/h",'</span>\n          </div>\n          <div class="workout__details">\n            <span class="workout__icon">').concat("running"===e?"üëü":"‚õ∞",'</span>\n            <span class="workout__value">').concat("running"===e?t.pace.toFixed(1):t.elevGain,'</span>\n            <span class="workout__unit">').concat("running"===e?"spm":"m",'</span>\n          </div>\n          <div class="workout__btns">\n          <span class="workout__btn edit">‚úèÔ∏è</span>\n            <span class="workout__btn trash">üóë</span>\n          </div>\n        </li>\n    ');k.style.display="none",k.insertAdjacentHTML("afterend",n),setTimeout((function(){return k.style.display="grid"}),700)}},{key:"_moveToMarker",value:function(t){var e=t.target.closest(".workout");if(e){var n=_(this,E).find((function(t){return t.id==e.dataset.id}));_(this,P).setView(n.coords,14,{animate:!0,pan:{duration:1}})}}},{key:"_storeWorkouts",value:function(){localStorage.setItem("workouts",JSON.stringify(_(this,E)))}},{key:"_loadWorkouts",value:function(){var t=this,e=JSON.parse(localStorage.getItem("workouts"));e&&(e.forEach((function(e){"running"==e.type&&_(t,E).push(new p(e.coords,e.distance,e.duration,new Date(e.date),e.cadence,e.pace,e.type)),"cycling"==e.type&&_(t,E).push(new h(e.coords,e.distance,e.duration,new Date(e.date),e.elevGain,e.speed,e.type))})),_(this,E).forEach((function(e){t._renderWorkoutMarker(e)})))}},{key:"reset",value:function(){localStorage.removeItem("workouts")}}])&&f(e.prototype,n),t}())})();